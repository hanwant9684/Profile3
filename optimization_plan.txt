# Nitro-Pyrogram Optimization Plan

## Objective
Achieve 10MB/s+ upload speed by hard-wiring the custom Pyrogram library specifically for this bot's file-handling patterns, eliminating all general-purpose overhead.

## Phase 1: The "Nitro" Network Layer (pyrogram/connection/transport/)
- [ ] Implement `TCPFullNitro`: A specialized transport that pre-calculates CRC32 using specialized CPU instructions (if available) and avoids all object allocations.
- [ ] Hard-wire socket buffer sizes to 8MB in the connection factory to match the VPS network stack capacity.

## Phase 2: Zero-Latency Session (pyrogram/session/)
- [ ] **Inline Crypto**: Remove `asyncio.run_in_executor` from `mtproto.pack`. Call `tgcrypto.encrypt` directly in the event loop.
- [ ] **Result-Less Uploads**: Modify `Session.send` to skip result tracking/event waiting for `SaveFilePart` and `SaveBigFilePart` requests.
- [ ] **Silent Sessions**: Disable all update handling for media-only DC connections to save CPU.

## Phase 3: Turbo Upload Engine (pyrogram/methods/advanced/save_file.py)
- [ ] **Producer-Consumer Overhaul**: Replace `asyncio.Queue` with a low-level sliding window buffer.
- [ ] **Non-Blocking Part Submission**: Implement a specialized `upload_nitro` method that sends parts without waiting for any intermediate RPC results, only checking for final success.
- [ ] **Hard-Wired Chunking**: Lock chunk size to 512KB and remove all conditional checks within the upload loop.

## Phase 4: Bot-App Integration (bot/transfer.py)
- [ ] **Priority Scheduling**: Implement a mechanism to pause non-essential tasks (like ad-fetching or database-backups) during active high-speed transfers.
- [ ] **GC Management**: Manually trigger `gc.collect()` before a transfer starts and disable it during the transfer to prevent stutter.

## Phase 5: Verification
- [ ] Hard-code throughput logging in the library to measure "Raw Network Speed" vs "Telegram Acknowledged Speed".
